name: Auto Packaging

on:
  push:
    branches: [ main, master ]
    paths:
      - 'unicast.m3u'
      # 注意：这里我改成了你实际生成的文件名
      - 'multicast-r2h.m3u' 
      - 'multicast-nofcc.m3u'
  workflow_dispatch:  # 允许手动触发
  schedule:
    - cron: '*/30 * * * *'  # 每半小时运行一次（UTC时间，对应北京时间每半小时的0分和30分）

permissions:
  contents: write

# --- 关键修改1：加入并发控制 ---
concurrency:
  group: playlist-update-group # 必须和另外两个工作流的组名完全一样！
  cancel-in-progress: false
# --------------------------------

jobs:
  create-release:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Set timezone to Beijing
      run: |
        sudo timedatectl set-timezone Asia/Shanghai
    
    # --- 后面的步骤保持不变 ---
    - name: Detect changes and generate release info
      id: release-info
      run: |
        # ... (这里的代码保持不变)
        # ...
    
    - name: Create full repository archive
      if: steps.release-info.outputs.has_changes == 'true'
      run: |
        # ... (这里的代码保持不变)
        # ...
    
    # ... 后续所有步骤都保持不变 ...
